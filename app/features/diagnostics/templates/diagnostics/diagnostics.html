{% extends "base.html" %}
{% block title %}Diagnostics{% endblock %}
{% block content %}
<h1>RTL‑SDR Diagnostics</h1>

<p>Click the button below to check if your RTL‑SDR dongle is present and streaming.</p>

<button id="checkBtn" class="btn btn-primary">Run Check</button>
<span id="statusBadge" class="badge bg-secondary ms-2">Not checked</span>

<pre id="outputBox" class="mt-3"></pre>

<script>
document.getElementById("checkBtn").addEventListener("click", () => {
  fetch("{{ url_for('diagnostics.diagnostics_check') }}")
    .then(r => r.json())
    .then(data => {
      const badge = document.getElementById("statusBadge");
      const output = document.getElementById("outputBox");
      if (data.success) {
        badge.textContent = "Dongle Present";
        badge.className = "badge bg-success ms-2";
      } else {
        badge.textContent = "Not Detected";
        badge.className = "badge bg-danger ms-2";
      }
      output.textContent = data.output;
    })
    .catch(err => {
      document.getElementById("statusBadge").textContent = "Error";
      document.getElementById("statusBadge").className = "badge bg-warning ms-2";
      document.getElementById("outputBox").textContent = err;
    });
});
</script>
{% endblock %}
