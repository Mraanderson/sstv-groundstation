{% extends "base.html" %}
{% block title %}Recorded Passes{% endblock %}
{% block content %}
<h1 class="mb-4">🎙️ Recorded Passes</h1>

<!-- Upload form -->
<h5>Upload Non‑ISS SSTV Audio</h5>
<form method="post" action="{{ url_for('recordings.upload_wav') }}" enctype="multipart/form-data" class="mb-4">
  <div class="input-group">
    <input type="file" name="wav_file" accept=".wav" class="form-control" required>
    <button type="submit" class="btn btn-success">📤 Upload & Decode</button>
  </div>
</form>

<!-- Status -->
{% if status %}
  {% if status.success %}
    <div class="alert alert-success">✅ Processed {{ status.wav_name }}</div>
  {% else %}
    <div class="alert alert-danger">⚠️ {{ status.error }}</div>
  {% endif %}
{% endif %}

<h5>Recordings directory: {{ rec_dir }}</h5>
<button class="btn btn-primary mb-3" onclick="location.reload()">🔄 Refresh</button>

<!-- ISS Recordings -->
<h3>🛰️ ISS Recordings</h3>
{% if iss_recordings %}
  <table class="table table-striped">
    <thead>
      <tr>
        <th>🕒 Time</th>
        <th>⏳ Duration</th>
        <th>💾 Size</th>
        <th>📂 Files</th>
      </tr>
    </thead>
    <tbody>
      {% for r in iss_recordings %}
        <tr>
          <td>{{ r.meta.timestamp or "?" }}</td>
          <td>{{ r.meta.duration_s or "?" }} s</td>
          <td>{{ r.meta.file_mb or "?" }} MB</td>
          <td>
            {% if r.wav_file %}<a href="{{ url_for('recordings.recordings_file', filename=r.wav_file.name) }}" target="_blank">🎵</a>{% endif %}
            {% if r.png_file %} | <a href="{{ url_for('recordings.recordings_file', filename=r.png_file.name) }}" target="_blank">🖼️</a>{% endif %}
            {% if r.log_file %} | <a href="{{ url_for('recordings.recordings_file', filename=r.log_file.name) }}" target="_blank">📄</a>{% endif %}
            {% if r.json_file %} | <a href="{{ url_for('recordings.recordings_file', filename=r.json_file.name) }}" target="_blank">🧾</a>{% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No ISS recordings found yet.</p>
{% endif %}

<!-- Other/Uploaded Files -->
<h3 class="mt-4">📂 Uploaded / Other Files</h3>
{% if other_files %}
  <ul class="list-group">
    {% for f in other_files %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <span>{{ f.name }}</span>
        <span>
          <a href="{{ url_for('recordings.recordings_file', filename=f.name) }}" target="_blank">🔗 Open</a>
          <!-- Delete -->
          <form method="post" action="{{ url_for('recordings.delete_file') }}" style="display:inline;">
            <input type="hidden" name="filename" value="{{ f.name }}">
            <button type="submit" class="btn btn-sm btn-danger">🗑️ Delete</button>
          </form>
          <!-- Rename -->
          <form method="post" action="{{ url_for('recordings.rename_file') }}" class="d-inline">
            <input type="hidden" name="old_name" value="{{ f.name }}">
            <input type="text" name="new_name" placeholder="New name" required>
            <button type="submit" class="btn btn-sm btn-secondary">✏️ Rename</button>
          </form>
        </span>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>No other files found.</p>
{% endif %}

{% endblock %}